{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    input[type="date"]::-webkit-calendar-picker-indicator {
        filter: invert(1);
    }
</style>
<script>
    $(document).ready(function () {
        // Set today's date in the date field
        var today = new Date().toISOString().split('T')[0];
        $("#dateInput").val(today);
    });
</script>
<div class="body-wrapper">
    <div class="container-fluid">
        <nav aria-label="breadcrumb" class="col-12">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'company_dashboard' %}"
                        class="text-warning-emphasis">Dashboard</a></li>
                <li class="breadcrumb-item"><a href="{% url 'items_list' %}" class="text-warning-emphasis">Stock
                        Adjustment</a></li>
                <li class="breadcrumb-item"><a href="{% url 'adjustment_overview' %}"
                        class="text-warning-emphasis">Adjustment overview</a></li>
                <li class="breadcrumb-item" aria-current="page">Edit Overview</li>
            </ol>
        </nav>
        <div class="container" style="background-color: black; border-radius: 20px; padding: 20px;">
            <h1 class="text-warning" style="color: white;"><strong>EDIT:</strong></h1>
            <form action="{% url 'stockeditdb' adjustment2.id %}" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="row" style="margin-bottom: 20px;">
                    <div class="col-md-6">
                        <div class="dropdown">
                            <div class="dropdown-heading" style="color: white;">
                                Item:
                            </div>
                            <select class="form-control" name="item" style="background-color: white;">
                                <option value="{{adjustment2.items.id}}" selected>{{adjustment2.items.item_name}}
                                </option>
                                {% for c in itemz %}
                                <option value="{{c.id}}" style="color: black;">
                                    {{c.item_name}}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <!-- Field 2 -->
                        <div class="dropdown">
                            <div class="dropdown-heading" style="color: white;">
                                Mode of Adjustment:
                            </div>
                            <select class="form-control" name="mode" style="background-color: white;width: 200px;">

                                <option value="Quantity adjustment" style="color: black;" selected>Quantity adjustment
                                </option>
                                <option value=">Value
                                adjustment" style="color: black;">Value
                                    adjustment</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Repeat the above pattern for the next 10 fields -->
                <div class="row" style="margin-bottom: 20px;">
                    <!-- Field 3 -->
                    <div class="col-md-6" style="color: white;">
                        <label for="reasonDropdown"
                            style="color: white; font-weight: bold; margin-left: 20px;">Reason</label>
                        <div class="input-group">
                            <select class="form-control" name="reason" id="reasonDropdown"
                                style="width: 100px; color: white;">
                                <option value="{{adjustment2.inventory_adjustment.Reason}}" style="color:black ;">
                                    {{adjustment2.inventory_adjustment.Reason}}</option>
                                <option value="High Demand Goods" style="color:black ;">High Demand Goods</option>
                                <option value="Stock Written Off" style="color:black ;">Stock Written Off</option>
                                <option value="Inventory Revaluation" style="color:black ;">Inventory Revaluation
                                </option>
                                <option value="Stock on Fire" style="color:black ;">Stock on Fire</option>

                            </select>
                            <button type="button" class="btn btn-warning" id="addReasonBtn" style="color: white;"><i
                                    class="fas fa-plus"></i></button>
                        </div>
                        <script>
                            $(document).ready(function () {
                                // Add new reason on button click
                                $('#addReasonBtn').on('click', function () {
                                    var newReason = prompt("Enter the new reason:");
                                    if (newReason) {
                                        // Create a new option, set its text and value, and append it to the dropdown
                                        var newOption = $('<option>', {
                                            value: newReason,
                                            text: newReason
                                        }).css('color', 'black'); // Set the text color to black
                                        $('#reasonDropdown').append(newOption);
                                    }
                                });
                            });
                        </script>
                    </div>

                    <!-- Field 4 -->
                    <div class="col-md-6" style="color: white;">
                        <label for="accountsDropdown"
                            style="color: white; font-weight: bold; margin-left: 20px;">Accounts</label>
                        <select class="form-control" name="account" id="accountsDropdown"
                            style="width: 150px; color: white;">
                            <option value="{{adjustment2.inventory_adjustment.Account}}" style="color:black ;">
                                {{adjustment2.inventory_adjustment.Account}}</option>
                            {% for c in account %}
                            <option value="{{c.id}}" style="color: black;">{{c.account_name}}</option>
                            {% endfor %}


                        </select>
                    </div>

                    <!-- Repeat the above pattern for the next 8 fields -->
                </div>

                <div class="row" style="margin-bottom: 20px;">
                    <div class="col-md-6" style="color: white;">
                        <!-- Field 1 -->
                        <label for="field1">Description:</label>
                        <input type="text" class="form-control" id="field1" name="description" style="color: white;"
                            value="{{adjustment2.inventory_adjustment.Description}}">
                    </div>
                    <div class="col-md-6" style="color: white;">
                        <label for="dateInput">Date:</label>
                        <input type="date" class="form-control" name="date" id="dateInput"
                            style="width: 150px; color: white;">
                    </div>


                </div>

                <!-- Repeat the above pattern for the next 10 fields -->
                <div class="row" style="margin-bottom: 20px;">
                    <!-- Field 3 -->
                    <div class="col-md-4" style="color: white;">
                        <label for="field3">Quantity available:</label>
                        <input type="number" class="form-control" id="field3" name="quantity-available"
                            style="color: white;" value="{{adjustment2.items.current_stock}}">
                    </div>

                    <!-- Field 4 -->
                    <div class="col-md-4" style="color: white;">
                        <label for="field4">New quantity in hand:</label>
                        <input type="number" class="form-control" id="newQuantity" oninput="updateQuantityAdjusted()"
                            name="quantity-inhand" value="{{adjustment2.New_quantity_inhand}}" style="color: white;">
                    </div>

                    <div class="col-md-4" style="color: white;">
                        <label for="quantityAdjusted">Quantity adjusted:</label>
                        <input type="number" class="form-control" value="{{adjustment2.Quantity_adjusted}}"
                            id="quantityAdjusted" name="quantity-adjusted" style="color: white;">
                    </div>
                </div>

                <script>
                    function updateQuantityAdjusted() {
                        var quantityAvailable = parseInt(document.getElementById("field3").value) || 0;
                        var newQuantity = parseInt(document.getElementById("newQuantity").value) || 0;
                        var quantityAdjusted = isNaN(newQuantity) ? 0 : newQuantity - quantityAvailable;
                        document.getElementById("quantityAdjusted").value = quantityAdjusted;
                    }
                </script>

                <div class="row" style="margin-bottom: 20px;">
                    <!-- Field 3 -->
                    <div class="col-md-4" style="color: white;">
                        <label for="field3">Current value:</label>
                        <input type="number" class="form-control" id="currentValue" name="currentvalue"
                            style="color: white;" value="{{stock_value}}">
                    </div>

                    <!-- Field 4 -->
                    <div class="col-md-4" style="color: white;">
                        <label for="changedValue">Changed value:</label>
                        <input type="number" class="form-control" value="{{adjustment2.Changed_value}}"
                            id="changedValue" name="changedvalue" style="color: white;" oninput="updateAdjustedValue()">
                    </div>

                    <div class="col-md-4" style="color: white;">
                        <label for="adjustedValue">Adjusted value:</label>
                        <input type="number" class="form-control" value="{{adjustment2.Adjusted_value}}"
                            id="adjustedValue" name="adjustedvalue" style="color: white;" readonly>
                    </div>
                </div>

                <!-- Repeat the above pattern for the next 8 fields -->

                <script>
                    function updateAdjustedValue() {
                        var currentValue = parseInt(document.getElementById("currentValue").value) || 0;
                        var changedValue = parseInt(document.getElementById("changedValue").value) || 0;
                        var adjustedValue = isNaN(changedValue) ? 0 : changedValue - currentValue;
                        document.getElementById("adjustedValue").value = adjustedValue;
                    }
                </script>


                <!-- Repeat the above pattern for the next 10 fields -->
                <div class="row" style="margin-bottom: 20px;">
                    <div class="col-md-4" style="color: white;">
                        <label for="reasonDropdown"
                            style="color: white; font-weight: bold; margin-left: 20px;">Reason</label>
                        <div class="input-group">
                            <select class="form-control" id="reasonDropdown" name="status"
                                style="width: 50px; color: white;">
                                <option value="{{adjustment2.inventory_adjustment.Status}}" selected>
                                    {{adjustment2.inventory_adjustment.Status}}
                                </option>
                                <option value="adjusted" style="color:black ;">Save</option>
                                <option value="draft" style="color:black ;">Draft</option>
                            </select>

                        </div>

                    </div>



                    <div class="col-md-4" style="color: white;margin-top:20px;">
                        <button type="submit" class="btn btn-outline-warning mb-2 mb-md-0">
                            <i class="fas fa-save text-warning"></i> Save
                        </button>
                    </div>
                </div>
            </form>
        </div>

    </div>
</div>
{% endblock %}