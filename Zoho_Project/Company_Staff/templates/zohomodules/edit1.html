<div class="container mt-3" style="background-color: black;">
    <div class="row">
        <div class="col-md-10">
            <!-- Make the table responsive -->
            <div class="table-responsive">
                <!-- Table for item transactions -->
                <table class="table" id="itemTransactionsTable">
                    <thead>
                        <tr>
                            <th style="color:white ;font-weight:bold;">#</th>
                            <th style="color:white ;font-weight:bold;">Item</th>
                            <th style="color:white ;font-weight:bold;">Current Value</th>
                            <th style="color:white ;font-weight:bold;">Changed Value</th>
                            <th style="color:white ;font-weight:bold;">Adjusted Value</th>
                            <th style="color:white ;font-weight:bold;"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Rows will be dynamically added here -->
                        <tr>

                            <td class="index">1</td>
                            <td class="item-details">
                                <div class="dropdown">
                                    <select class="form-control item-dropdown" name="item2"
                                        style="background-color: white;">
                                        <option value="" selected disabled>Select item</option>
                                        {% for c in item %}
                                        <option value="{{c.id}}" style="color: black;">{{c.item_name}}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </td>
                            <script>
                                $('.item-dropdown').on('change', function () {
                                    var selectedOption = $(this).find(':selected');
                                    var itemId = selectedOption.val();
                                    var quantityAvailableField = $(this).closest('tr').find('.item-quantity');

                                    $.ajax({
                                        type: "GET",
                                        url: "{% url 'get_item_price' %}",
                                        data: { id: itemId },
                                    }).done(function (response) {
                                        // Update the quantity-available input field with the current stock
                                        quantityAvailableField.val(response.price);
                                    });
                                });
                            </script>


                            <td class="quantity-available">
                                <input type="number" name="stock_value" class="form-control item-quantity"
                                    value="" style="color: white;">
                            </td>
                            <td class="new-quantity">
                                <input type="number" name="changedvalue" class="form-control" id="changedValue"
                                    oninput="updateAdjustedValue()" style="color: white;">
                            </td>
                            <td class="quantity-adjusted">
                                <input type="number" name="adjustedvalue" class="form-control"
                                id="adjustedValue"  style="color: white;" readonly>
                            </td>
                            <td>
                                <div class="col-md-1">
                                    <button type="button" class="btn btn-danger remove-row"><i
                                            class="fas fa-minus"></i></button>
                                </div>
                                <div class="col-md-1">
                                    <button type="button" class="btn btn-success add-row"><i
                                            class="fas fa-plus"></i></button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <script>
                    function updateAdjustedValue() {
                        var currentValue = parseInt(document.querySelector(".quantity-available input").value);
                        var changedValue = parseInt(document.getElementById("changedValue").value);
                        var adjustedValue = isNaN(changedValue) ? 0 : changedValue - currentValue;
                        document.getElementById("adjustedValue").value = adjustedValue;
                    }
                </script>
            </div>
        </div>
    </div>
</div>